<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>Property Details | PropertiesWala</title>
  <meta name="description" content="View verified property details on PropertiesWala. Commercial and residential listings across Kolkata and West Bengal." />

  <link rel="stylesheet" href="style.css" />
</head>

<body>

  <header class="navbar">
    <div class="nav-container">
      <div class="logo">
        Properties<span>Wala</span>
      </div>

      <nav class="nav-links">
        <a href="index.html#home">Home</a>
        <a href="index.html#lead">Requirement</a>
        <a href="index.html#properties">Properties</a>
        <a href="index.html#contact">Contact</a>
      </nav>
    </div>
  </header>

  <section class="properties-section">
    <h2>Property Details</h2>
    <div id="detailsBox" class="details-box"></div>
  </section>

  <footer class="footer">
    <p>Â© 2026 PropertiesWala. All rights reserved.</p>
  </footer>

  <script>
    const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRgoZIBoAGvAYPO4Nz2se3QJ8aWENUUfYtLW7l25i3B0EkVzYzhgrtupPOIbPXuJ8N_wKf_E9ckipxv/pub?output=csv";
    const OWNER_WHATSAPP = "919433365152";
    const WEBSITE_BASE = "https://propertieswala.in";

    function clean(v) {
      return (v || "").toString().trim().replace(/^"+|"+$/g, "");
    }

    function csvToRows(csvText) {
      const lines = csvText.split(/\r?\n/).filter(Boolean);
      const rows = [];

      for (let line of lines) {
        const cols = [];
        let current = "";
        let insideQuotes = false;

        for (let i = 0; i < line.length; i++) {
          const ch = line[i];

          if (ch === '"' && line[i + 1] === '"') {
            current += '"';
            i++;
          } else if (ch === '"') {
            insideQuotes = !insideQuotes;
          } else if (ch === "," && !insideQuotes) {
            cols.push(current);
            current = "";
          } else {
            current += ch;
          }
        }

        cols.push(current);
        rows.push(cols.map(c => clean(c)));
      }

      return rows;
    }

    function buildWhatsAppLink(number, message) {
      const num = clean(number).replace(/\D/g, "") || OWNER_WHATSAPP;
      return `https://wa.me/${num}?text=${encodeURIComponent(message)}`;
    }

    function getQueryParam(name) {
      const url = new URL(window.location.href);
      return url.searchParams.get(name);
    }

    async function loadDetails() {
      const id = getQueryParam("id");
      const box = document.getElementById("detailsBox");

      if (!id) {
        box.innerHTML = "<p>No Property ID found.</p>";
        return;
      }

      try {
        const res = await fetch(CSV_URL, { cache: "no-store" });
        const text = await res.text();
        const rows = csvToRows(text);

        const headers = rows[0];
        const data = rows.slice(1).map(r => {
          const obj = {};
          headers.forEach((h, i) => obj[h] = r[i] || "");
          return obj;
        });

        const p = data.find(x => clean(x.ID) === clean(id));

        if (!p) {
          box.innerHTML = "<p>Property not found.</p>";
          return;
        }

        const type = clean(p.Type);
        const location = clean(p.Location);
        const area = clean(p.Area);
        const price = clean(p.Price);
        const img = clean(p.Image);

        document.title = `${type} in ${location} | PropertiesWala`;

        const waMsg =
          `Hello PropertiesWala, I am interested in this property:\n\n` +
          `ID: ${p.ID}\nType: ${type}\nLocation: ${location}\nArea: ${area} sqft\nPrice: ${price}\n\n` +
          `Link: ${WEBSITE_BASE}/property.html?id=${encodeURIComponent(p.ID)}\n\n` +
          `Please share more details and visit schedule.`;

        const waLink = buildWhatsAppLink(p.WhatsApp || OWNER_WHATSAPP, waMsg);

        box.innerHTML = `
          <div class="property-card">
            <div class="property-image">
              <img src="${img}" alt="${type} in ${location}" loading="lazy" />
            </div>

            <div class="property-body">
              <h3>${type}</h3>
              <p><strong>Property ID:</strong> ${p.ID}</p>
              <p><strong>Location:</strong> ${location}</p>
              <p><strong>Area:</strong> ${area} sqft</p>
              <p><strong>Price:</strong> ${price}</p>

              <div class="btn-row">
                <a class="btn-primary" target="_blank" href="${waLink}">WhatsApp Enquiry</a>
                <a class="btn-outline" href="index.html#properties">Back to Listings</a>
              </div>
            </div>
          </div>
        `;
      } catch (err) {
        box.innerHTML = "<p>Error loading details.</p>";
        console.log(err);
      }
    }

    loadDetails();
  </script>

</body>
</html>
