<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>PropertiesWala | Verified Property Listings in Kolkata & West Bengal</title>

  <!-- ✅ FAVICON (root file) -->
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png" />

  <!-- ✅ SEO BASIC -->
  <meta name="description" content="PropertiesWala provides verified commercial and residential properties across Kolkata & West Bengal. Direct WhatsApp support and site visit assistance." />
  <meta name="robots" content="index, follow" />

  <!-- ✅ CSS -->
  <link rel="stylesheet" href="style.css" />
</head>

<body>

  <!-- ✅ NAVBAR -->
  <header class="navbar" id="home">
    <div class="logo">Properties<span>Wala</span></div>
    <nav>
      <a href="#home">Home</a>
      <a href="#properties">Properties</a>
      <a href="#contact">Contact</a>
    </nav>
  </header>

  <!-- ✅ HERO -->
  <section class="hero">
    <div class="hero-overlay"></div>

    <div class="hero-content">
      <h1>Trusted Property Solutions Across West Bengal</h1>
      <p>Residential & Commercial Properties • Honest Advice • Verified Listings</p>

      <input
        type="text"
        placeholder="Search by location or property type (Coming Soon)"
        disabled
      />

      <div class="filters">
        <button class="filter-btn active" data-filter="All">All</button>
        <button class="filter-btn" data-filter="Residential">Residential</button>
        <button class="filter-btn" data-filter="Commercial">Commercial</button>
      </div>
    </div>
  </section>

  <!-- ✅ PROPERTIES -->
  <section id="properties" class="properties">
    <h2>Latest Available Properties</h2>

    <div id="loadingMsg" class="loading-msg">Loading properties...</div>

    <div id="propertyGrid" class="property-grid"></div>
  </section>

  <!-- ✅ CONTACT -->
  <section id="contact" class="contact">
    <h2>Contact Us</h2>
    <p>Speak directly with a property expert for verified listings and honest advice.</p>

    <div class="contact-box">
      <div>
        <strong>Call Now:</strong>
        <a class="contact-link" href="tel:+919433365152">+91 9433365152</a>
      </div>

      <div>
        <strong>WhatsApp:</strong>
        <a class="contact-link" target="_blank"
          href="https://wa.me/919433365152?text=Hello%20PropertiesWala%2C%20I%20want%20property%20details.">
          Chat on WhatsApp
        </a>
      </div>
    </div>
  </section>

  <!-- ✅ FOOTER -->
  <footer class="footer">
    <p>© 2026 PropertiesWala. All rights reserved.</p>
  </footer>

  <!-- ✅ JAVASCRIPT -->
  <script>
    // ✅ Your Google Sheet CSV Link
    const CSV_URL =
      "https://docs.google.com/spreadsheets/d/e/2PACX-1vRgoZIBoAGvAYPO4Nz2se3QJ8aWENUUfYtLW7l25i3B0EkVzYzhgrtupPOIbPXuJ8N_wKf_E9ckipxv/pub?output=csv";

    const propertyGrid = document.getElementById("propertyGrid");
    const loadingMsg = document.getElementById("loadingMsg");

    let allProperties = [];
    let activeFilter = "All";

    // ✅ CSV Parser (supports commas in quotes)
    function parseCSV(text) {
      const rows = [];
      let row = [];
      let current = "";
      let insideQuotes = false;

      for (let i = 0; i < text.length; i++) {
        const char = text[i];
        const nextChar = text[i + 1];

        if (char === '"' && insideQuotes && nextChar === '"') {
          current += '"';
          i++;
        } else if (char === '"') {
          insideQuotes = !insideQuotes;
        } else if (char === "," && !insideQuotes) {
          row.push(current.trim());
          current = "";
        } else if ((char === "\n" || char === "\r") && !insideQuotes) {
          if (current.length > 0 || row.length > 0) {
            row.push(current.trim());
            rows.push(row);
          }
          row = [];
          current = "";
        } else {
          current += char;
        }
      }

      if (current.length > 0 || row.length > 0) {
        row.push(current.trim());
        rows.push(row);
      }

      return rows;
    }

    function safeText(t) {
      if (!t) return "";
      return String(t).replace(/"/g, "").trim();
    }

    function renderProperties(list) {
      propertyGrid.innerHTML = "";

      if (!list.length) {
        propertyGrid.innerHTML = `<p style="text-align:center; font-weight:600;">No properties found.</p>`;
        return;
      }

      list.forEach((p) => {
        const id = safeText(p.ID);
        const category = safeText(p.Category);
        const type = safeText(p.Type);
        const location = safeText(p.Location);
        const area = safeText(p.Area);
        const price = safeText(p.Price);
        const img = safeText(p.Image);
        const whatsapp = safeText(p.WhatsApp);

        const waNumber = whatsapp ? whatsapp.replace(/\D/g, "") : "919433365152";

        // ✅ Image URL: if sheet has FULL URL, use it directly
        // else if sheet has like: image/PR1.jpg then it will work also
        const imageUrl = img.startsWith("http") ? img : img;

        const msg = encodeURIComponent(
          `Hello PropertiesWala, I'm interested in this property:\nID: ${id}\nType: ${type}\nLocation: ${location}\nPrice: ${price}`
        );

        const card = document.createElement("div");
        card.className = "property-card";

        card.innerHTML = `
          <div class="property-image">
            <img src="${imageUrl}" alt="${type} in ${location}" loading="lazy" onerror="this.style.display='none'; this.parentElement.classList.add('no-image');" />
          </div>

          <div class="property-body">
            <h3>${type || "Property"}</h3>
            <p><strong>Location:</strong> ${location || "-"}</p>
            <p><strong>Area:</strong> ${area ? area + " sqft" : "-"}</p>
            <p><strong>Price:</strong> ${price || "-"}</p>

            <a class="whatsapp-btn" target="_blank"
              href="https://wa.me/${waNumber}?text=${msg}">
              WhatsApp Enquiry
            </a>
          </div>
        `;

        propertyGrid.appendChild(card);
      });
    }

    function applyFilter() {
      if (activeFilter === "All") {
        renderProperties(allProperties);
        return;
      }
      const filtered = allProperties.filter(
        (p) => safeText(p.Category).toLowerCase() === activeFilter.toLowerCase()
      );
      renderProperties(filtered);
    }

    async function loadProperties() {
      try {
        loadingMsg.style.display = "block";

        const res = await fetch(CSV_URL, { cache: "no-store" });
        const csvText = await res.text();

        const rows = parseCSV(csvText);
        const headers = rows[0];

        const dataRows = rows.slice(1).filter((r) => r.length > 2);

        allProperties = dataRows.map((r) => {
          const obj = {};
          headers.forEach((h, i) => {
            obj[safeText(h)] = safeText(r[i] || "");
          });
          return obj;
        });

        loadingMsg.style.display = "none";
        applyFilter();

      } catch (err) {
        console.error("CSV load error:", err);
        loadingMsg.innerHTML = "Failed to load properties. Please try again.";
      }
    }

    // ✅ Filter button logic
    document.querySelectorAll(".filter-btn").forEach((btn) => {
      btn.addEventListener("click", () => {
        document.querySelectorAll(".filter-btn").forEach((b) => b.classList.remove("active"));
        btn.classList.add("active");
        activeFilter = btn.dataset.filter;
        applyFilter();
      });
    });

    loadProperties();
  </script>

</body>
</html>
