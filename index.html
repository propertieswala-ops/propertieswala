<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>PropertiesWala | Verified Property Listings in Kolkata & West Bengal</title>
  <meta name="description" content="PropertiesWala provides verified residential & commercial property listings across Kolkata & West Bengal. Contact now for direct site visit support." />
  <link rel="canonical" href="https://propertieswala.in/" />

  <link rel="stylesheet" href="style.css" />
</head>

<body>

  <!-- ================= NAVBAR ================= -->
  <header class="navbar">
    <div class="nav-container">
      <div class="logo">
        Properties<span>Wala</span>
      </div>

      <nav class="nav-links">
        <a href="#home">Home</a>
        <a href="#lead">Requirement</a>
        <a href="#properties">Properties</a>
        <a href="#contact">Contact</a>
      </nav>
    </div>
  </header>

  <!-- ================= HERO ================= -->
  <section id="home" class="hero">
    <div class="hero-overlay"></div>

    <div class="hero-content">
      <h1>Trusted Property Solutions Across West Bengal</h1>
      <p>Residential & Commercial Properties â€¢ Honest Advice â€¢ Verified Listings</p>

      <input class="hero-search" type="text" placeholder="Search by location or property type (Coming Soon)" disabled />

      <div class="filters">
        <button class="filter-btn active" data-filter="All">All</button>
        <button class="filter-btn" data-filter="Residential">Residential</button>
        <button class="filter-btn" data-filter="Commercial">Commercial</button>
      </div>
    </div>
  </section>

  <!-- ================= LEAD FORM ================= -->
  <section id="lead" class="lead-section">
    <div class="lead-box">
      <div class="lead-left">
        <h2>Get Call Back in 10 Minutes</h2>
        <p>Submit your requirement. We will share matching verified options quickly.</p>

        <ul class="trust-points">
          <li>Verified Listings Only</li>
          <li>Direct Site Visit Support</li>
          <li>Kolkata & West Bengal Specialist</li>
          <li>Fast WhatsApp Response</li>
        </ul>
      </div>

      <form id="leadForm" class="lead-form">
        <input type="text" id="leadName" placeholder="Your Name" required />
        <input type="tel" id="leadPhone" placeholder="Your Phone Number" required />

        <select id="leadCategory" required>
          <option value="">Select Category</option>
          <option value="Commercial">Commercial</option>
          <option value="Residential">Residential</option>
        </select>

        <select id="leadDeal" required>
          <option value="">Buy / Rent</option>
          <option value="Buy">Buy</option>
          <option value="Rent">Rent</option>
        </select>

        <input type="text" id="leadBudget" placeholder="Budget (Example: 2.5 Cr / 70 Lakh)" required />
        <input type="text" id="leadArea" placeholder="Preferred Area (Example: Park Street, Kolkata)" required />

        <button type="submit" class="lead-submit">Submit Requirement</button>

        <div id="leadMsg" class="lead-msg"></div>
      </form>
    </div>
  </section>

  <!-- ================= PROPERTIES ================= -->
  <section id="properties" class="properties-section">
    <h2>Latest Available Properties</h2>
    <div id="propertyGrid" class="property-grid"></div>

    <div id="loadingText" class="loading-text">Loading properties...</div>
    <div id="errorText" class="error-text"></div>
  </section>

  <!-- ================= CONTACT ================= -->
  <section id="contact" class="contact-section">
    <h2>Contact Us</h2>
    <p>Speak directly with a property expert for verified listings and honest advice.</p>

    <div class="contact-card">
      <div>
        <strong>Call Now:</strong><br/>
        <a class="contact-link" href="tel:+919433365152">+91 9433365152</a>
      </div>

      <div>
        <strong>WhatsApp:</strong><br/>
        <a class="contact-link" target="_blank"
          href="https://wa.me/919433365152?text=Hello%20PropertiesWala%2C%20I%20want%20verified%20property%20options%20in%20Kolkata.">
          Chat on WhatsApp
        </a>
      </div>
    </div>
  </section>

  <!-- ================= FOOTER ================= -->
  <footer class="footer">
    <p>Â© 2026 PropertiesWala. All rights reserved.</p>
  </footer>

  <!-- ================= FLOATING BUTTONS ================= -->
  <a class="floating-btn floating-call" href="tel:+919433365152" title="Call Now">Call</a>

  <a class="floating-btn floating-wa"
    target="_blank"
    href="https://wa.me/919433365152?text=Hello%20PropertiesWala%2C%20I%20want%20property%20details%20and%20site%20visit%20support."
    title="WhatsApp Now">
    WhatsApp
  </a>

  <!-- ================= JAVASCRIPT ================= -->
  <script>
    // ============================
    // SETTINGS (EDIT ONLY ONCE)
    // ============================
    const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRgoZIBoAGvAYPO4Nz2se3QJ8aWENUUfYtLW7l25i3B0EkVzYzhgrtupPOIbPXuJ8N_wKf_E9ckipxv/pub?output=csv";
    const OWNER_WHATSAPP = "919433365152";
    const WEBSITE_BASE = "https://propertieswala.in";

    // âœ… UPDATED: Your Real Apps Script Web App URL (Mini CRM)
    const APPS_SCRIPT_WEBAPP_URL = "https://script.google.com/macros/s/AKfycbw0-YOhLZyIH4XAm9QJ0RqjF4RxkTsAvYRTT-BPOVK3tpqSmEnLrMBnsVOf5p_rs5WjAQ/exec";

    let ALL_PROPERTIES = [];
    let ACTIVE_FILTER = "All";

    // ============================
    // HELPERS
    // ============================
    function escapeHTML(str) {
      if (!str) return "";
      return String(str)
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    function clean(v) {
      return (v || "").toString().trim().replace(/^"+|"+$/g, "");
    }

    function normalizeCategory(cat) {
      const c = clean(cat).toLowerCase();
      if (c.includes("res")) return "Residential";
      if (c.includes("com")) return "Commercial";
      return clean(cat);
    }

    function buildWhatsAppLink(number, message) {
      const num = clean(number).replace(/\D/g, "") || OWNER_WHATSAPP;
      return `https://wa.me/${num}?text=${encodeURIComponent(message)}`;
    }

    // Robust CSV parsing (supports commas inside quotes)
    function csvToRows(csvText) {
      const lines = csvText.split(/\r?\n/).filter(Boolean);
      const rows = [];

      for (let line of lines) {
        const cols = [];
        let current = "";
        let insideQuotes = false;

        for (let i = 0; i < line.length; i++) {
          const ch = line[i];

          if (ch === '"' && line[i + 1] === '"') {
            current += '"';
            i++;
          } else if (ch === '"') {
            insideQuotes = !insideQuotes;
          } else if (ch === "," && !insideQuotes) {
            cols.push(current);
            current = "";
          } else {
            current += ch;
          }
        }

        cols.push(current);
        rows.push(cols.map(c => clean(c)));
      }

      return rows;
    }

    function makePropertyDetailsURL(id) {
      return `${WEBSITE_BASE}/property.html?id=${encodeURIComponent(id)}`;
    }

    function copyToClipboard(text) {
      if (!navigator.clipboard) {
        alert("Copy not supported. Please copy manually: " + text);
        return;
      }
      navigator.clipboard.writeText(text)
        .then(() => alert("âœ… Link Copied!"))
        .catch(() => alert("âŒ Copy failed. Please try again."));
    }

    // ============================
    // RENDER PROPERTIES
    // ============================
    function renderProperties(list) {
      const grid = document.getElementById("propertyGrid");
      const loadingText = document.getElementById("loadingText");

      grid.innerHTML = "";

      if (!list || list.length === 0) {
        loadingText.textContent = "No properties found.";
        loadingText.style.display = "block";
        return;
      }

      loadingText.style.display = "none";

      list.forEach((p) => {
        const id = clean(p.ID);
        const category = normalizeCategory(p.Category);
        const type = clean(p.Type);
        const location = clean(p.Location);
        const area = clean(p.Area);
        const price = clean(p.Price);
        const imgUrl = clean(p.Image);

        const altText = `${type || "Property"} in ${location || "Kolkata"} | PropertiesWala`;

        const detailsUrl = makePropertyDetailsURL(id);

        const enquiryMsg =
          `Hello PropertiesWala, I am interested in this property:\n\n` +
          `ID: ${id}\n` +
          `Category: ${category}\n` +
          `Type: ${type}\n` +
          `Location: ${location}\n` +
          `Area: ${area} sqft\n` +
          `Price: ${price}\n\n` +
          `Link: ${detailsUrl}\n\n` +
          `Please share more photos & arrange a site visit.`;

        const waEnquiryLink = buildWhatsAppLink(p.WhatsApp || OWNER_WHATSAPP, enquiryMsg);

        const shareMsg =
          `âœ… Verified Property - PropertiesWala\n\n` +
          `Type: ${type}\n` +
          `Location: ${location}\n` +
          `Area: ${area} sqft\n` +
          `Price: ${price}\n\n` +
          `ðŸ‘‰ Full details: ${detailsUrl}\n\n` +
          `ðŸ“ž Call: +91 9433365152`;

        const waShareLink = buildWhatsAppLink("", shareMsg);

        const card = document.createElement("div");
        card.className = "property-card";

        card.innerHTML = `
          <div class="property-image">
            <img
              src="${escapeHTML(imgUrl)}"
              alt="${escapeHTML(altText)}"
              loading="lazy"
              onerror="this.style.display='none'; this.parentElement.classList.add('no-image');"
            />
            <div class="property-badge">${escapeHTML(category || "Property")}</div>
          </div>

          <div class="property-body">
            <h3>${escapeHTML(type)}</h3>
            <p><strong>Location:</strong> ${escapeHTML(location)}</p>
            <p><strong>Area:</strong> ${escapeHTML(area)} sqft</p>
            <p><strong>Price:</strong> ${escapeHTML(price)}</p>

            <div class="btn-row">
              <a class="btn-primary" target="_blank" href="${waEnquiryLink}">
                WhatsApp Enquiry
              </a>

              <a class="btn-outline" href="property.html?id=${encodeURIComponent(id)}">
                View Details
              </a>
            </div>

            <div class="btn-row">
              <a class="btn-dark" target="_blank" href="${waShareLink}">
                Share
              </a>

              <button class="btn-copy" type="button" data-copy="${escapeHTML(detailsUrl)}">
                Copy Link
              </button>
            </div>

            <div class="mini-actions">
              <a class="mini-call" href="tel:+919433365152">Call Now</a>
            </div>
          </div>
        `;

        grid.appendChild(card);
      });

      // Copy button handler
      document.querySelectorAll(".btn-copy").forEach(btn => {
        btn.addEventListener("click", () => {
          const link = btn.getAttribute("data-copy");
          copyToClipboard(link);
        });
      });
    }

    function applyFilter() {
      const errorText = document.getElementById("errorText");
      errorText.textContent = "";

      if (ACTIVE_FILTER === "All") {
        renderProperties(ALL_PROPERTIES);
        return;
      }

      const filtered = ALL_PROPERTIES.filter(p => normalizeCategory(p.Category) === ACTIVE_FILTER);
      renderProperties(filtered);
    }

    async function loadCSV() {
      const loadingText = document.getElementById("loadingText");
      const errorText = document.getElementById("errorText");

      loadingText.style.display = "block";
      loadingText.textContent = "Loading properties...";
      errorText.textContent = "";

      try {
        const res = await fetch(CSV_URL, { cache: "no-store" });
        if (!res.ok) throw new Error("CSV not loading. Check Publish to Web setting.");

        const text = await res.text();
        const rows = csvToRows(text);

        const headers = rows[0].map(h => clean(h));

        const data = rows.slice(1).map(row => {
          const obj = {};
          headers.forEach((h, i) => obj[h] = row[i] ? clean(row[i]) : "");
          obj.Category = normalizeCategory(obj.Category);
          return obj;
        });

        ALL_PROPERTIES = data.filter(p => p.ID && p.Type);
        loadingText.style.display = "none";
        applyFilter();

      } catch (err) {
        console.error(err);
        loadingText.style.display = "none";
        errorText.textContent = "âŒ Error loading properties. Please check Google Sheet publish settings.";
      }
    }

    // Filter buttons
    document.querySelectorAll(".filter-btn").forEach(btn => {
      btn.addEventListener("click", () => {
        document.querySelectorAll(".filter-btn").forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        ACTIVE_FILTER = btn.dataset.filter;
        applyFilter();
      });
    });

    // ============================
    // LEAD FORM: Save to Google Sheet + WhatsApp
    // ============================
    document.getElementById("leadForm").addEventListener("submit", async function(e) {
      e.preventDefault();

      const leadMsg = document.getElementById("leadMsg");
      leadMsg.textContent = "Submitting...";
      leadMsg.style.color = "#1f3b5d";

      const name = clean(document.getElementById("leadName").value);
      const phone = clean(document.getElementById("leadPhone").value);
      const category = clean(document.getElementById("leadCategory").value);
      const deal = clean(document.getElementById("leadDeal").value);
      const budget = clean(document.getElementById("leadBudget").value);
      const area = clean(document.getElementById("leadArea").value);

      const payload = {
        date: new Date().toISOString(),
        name,
        phone,
        category,
        deal,
        budget,
        area,
        source: "Website"
      };

      // âœ… Save to Google Sheet (Apps Script)
      let sheetSaved = false;
      try {
        await fetch(APPS_SCRIPT_WEBAPP_URL, {
          method: "POST",
          mode: "no-cors",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });
        sheetSaved = true;
      } catch (err) {
        console.log("Apps Script save error:", err);
      }

      // âœ… Send WhatsApp notification to owner
      const ownerText =
        `âœ… New Lead from PropertiesWala.in\n\n` +
        `Name: ${name}\n` +
        `Phone: ${phone}\n` +
        `Category: ${category}\n` +
        `Buy/Rent: ${deal}\n` +
        `Budget: ${budget}\n` +
        `Preferred Area: ${area}\n\n` +
        `Please send matching verified properties.`;

      const waOwnerLink = buildWhatsAppLink(OWNER_WHATSAPP, ownerText);

      leadMsg.textContent = sheetSaved
        ? "âœ… Lead submitted & saved. Opening WhatsApp..."
        : "âœ… Lead submitted. Opening WhatsApp...";
      leadMsg.style.color = "green";

      document.getElementById("leadForm").reset();

      window.open(waOwnerLink, "_blank");
    });

    // Start
    loadCSV();
  </script>

</body>
</html>
